# Open data based electricity load forecasting
## By David Íñiguez

### Abstract
Electricity is one of the main engines of modern societies. The agents that are involved in the electricity system of a country need to have the best forecasts possible of electricity load in order to ensure that it is correctly supplied, and also to define their action strategies in the market. In this thesis we will focus on the electricity load forecasting for the daily market of the so called Mercado Ibérico de Electricidad (MIBEL), where most of the energy available is auctioned. We studied the State-of-the-Art of the electricity demand approaches, specially for short-term predictions, since we are making one day-ahead estimations. We extracted data from open sources that were later used for designing and testing different types of models. Based on the performance of the different approaches, we selected a model that efficiently combines both time series forecasting and machine learning, obtaining a precision close to the one provided by the system operator, Red Eléctrica. Finally, we analyzed the relevance of each of the variables involved by using the Shapley values and regularization techniques.

### Contents
#### Jupyter notebooks
This repo includes all the jupyter notebooks used in this thesis. 
- **Preprocessing notebooks:**
    - _Cities_unified.ipynb_: Used to build the _Cities_unified.csv_ file. This csv file contains the population of all provinces throughout years and their coordinates. 
    - _Economy.ipynb_: Used to build both _IPC.csv_ and _PIB.csv_ files. The first file contains the CPI of all provinces and the total since 2014 and the second one the GDP of Spain.
    - _OpenMeteoAPI.ipynb_: Used to build the _demanda_meteo.csv_ file given the _Cities_unified.csv_ and the demand data from ESIOS. The file _demanda_meteo.csv_ contains the climate information of each province and the demand records.  Note that sometimes this notebook raises an error when using the OpenMeteo API. In that case, just run the code until the 50 provinces of Spain have been displayed.
    - _Festivos.ipynb_: Used to build the _Festivos.csv_ file.
    - _Generate_input.ipynb_: Used to build the inputs of the experiment where exogenous variables are relevant. One can decide the number of previous days to be computed. 

- **Data exploration:**
    - _Data Exploration.ipynb_: In this notebook we study the dependencies of the electricity load with different factors, such as temperature, the calendar, the hour of the day...     
-  **Experimental Setup**
    -   _Model Selection.ipynb_: Here we test different models (Linear, XGBoost, Autoregressive, ForecasterAutoReg, Deep Learning) on a simple input.
    -   _Skforecast - Forecasters Testing.ipynb_: Testing he ForecasterAutoReg model from the Skforecast library with different machine learning models as regressors.
    -   _Skforecast - Exog - tuning.ipynb_: Experiment with the input generated by _Generate_input.ipynb_, using the ForecasterAutoReg model from the Skforecast library with XGBoost as regressor. We include exogenous variables, perform hyperparameter tuning and compare the results obtained with the ESIOS predictions. One can also visualize the impact of each variable on the model predictions (explainability) using the Shapley Values.
    -   _Explainability - Regularization Path_: Using a linear model, feature selection is performed using L1 regularization, and using the variables selected by this model in the best performing model we fit and tune a ForecasterAutoReg model from the Skforecast library with XGBoost as regressor. Then we use Shapley values to understand the decision-making on the Skforecast model.
- **24 models approach:**
    - _Small Models - Model Selection.ipynb_: We try different types of model, and for each of them we fit 24 models (one per hour of the day) using the same input as _Model Selection.ipynb_.
    - _Small Models - Base Input.ipynb_: We try once again the same models as _Small Models - Model Selection.ipynb_ with the input generated by _Generate_input.ipynb_.
    - _Small Models - Skforecast.ipynb_: Equivalent to the _Skforecast - Exog - tuning.ipynb_ notebook, but in this case fitting 24 models (one for each hour) instead of one model for all hours.

#### CSV files
They are all included in the _inputs.zip_ folder. It includes three folders, _DatosESIOS_, _Inputs_ and _Base Inputs_. The first two contain different csv, all of them extracted from open data sources. They contain information about the economy, the calendar and population. The third one is empty, and there one can add the outputs of the _Generate_input.ipynb_ notebook.

### Procedure
First, run the notebooks _Cities_unified.ipynb_, _Economy.ipynb_ and _Festivos.ipynb_. Then, run _OpenMeteoAPI.ipynb_. With these 4 notebooks, one can run the following notebooks: _Generate_input.ipynb_, _Data Exploration.ipynb_, _Model Selection.ipynb_, _Small Models - Model Selection.ipynb_. However, if the user wants to execute some of the remaining codes (_Skforecast - Forecasters Testing.ipynb_, _Skforecast - Exog - tuning.ipynb_, _Explainability - Regularization Path_, _Small Models - Base Input.ipynb_, _Small Models - Skforecast.ipynb_), it is mandatory to have run before _Generate_input.ipynb_ with the wanted configuration.
